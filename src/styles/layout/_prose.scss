@mixin shared-styles-nested-margin() {
  & > * {
    &:first-child {
      @apply mt-0 #{!important};
    }

    &:last-child {
      @apply mb-0 #{!important};
    }
  }
}

@mixin shared-styles-pseudo-loader() {
  @apply relative rounded-btn pointer-events-none;

  &:before {
    @apply content-[''] bg-base-100 absolute inset-0;
  }

  &:after {
    @apply content-[''] bg-base-300 animate-pulse absolute inset-0;
  }
}

/* Update prose */

.prose {
  h1, h2, h3, h4, h5, h6 {
    @apply my-4 overflow-hidden text-ellipsis;
  }

  hr {
    @apply my-4;
  }

  iframe {
    @apply rounded-box aspect-video w-full h-auto bg-base-300;
  }

  img {
    @apply bg-base-200 m-0;

    &:not(.mask) {
      @apply rounded-box;
    }

    &:not([width]):not([height]) {
      @apply w-full;
    }
  }

  /* https://stackoverflow.com/questions/5379752/css-style-external-links */

  a {
    &[href]:not(:where([href^="#"],[href^="/"]:not([href^="//"]),[href*="//localhost"])) {
      &:not(.not-prose):not(.token.url-link):not(.btn):not(:has(img)) {
        @apply link inline-block after:content-['\279A'] after:inline-block after:px-1;
      }
    }
  }

  blockquote {
    @apply border-primary bg-primary/10 my-4 px-4;

    p {
      @apply before:content-none after:content-none not-italic m-0 py-2;
    }

    blockquote {
      @apply my-0;
    }
  }

  p {
    @apply my-4;

    &:not(.not-prose) {
      @apply text-ellipsis overflow-hidden;

      &:empty {
        @apply hidden;
      }
    }
  }

  pre.mermaid {
    @apply bg-base-200/50 p-4;

    &:not(:has(svg)) {
      @apply text-base-content;
    }

    svg {
      @apply mx-auto;
    }
  }

  pre:not(.mermaid) {
    @apply text-sm #{!important};
  }

  code:not(pre code) {
    @apply inline bg-base-300 text-base-content font-normal rounded p-1;
  }

  ul {
    @apply my-4;

    &.task-list {
      @apply list-none p-0;

      label {
        @apply justify-start p-0 my-2;
      }

      li {
        @apply p-0 my-0;
      }

      ul {
        @apply p-0 my-0 ml-8;
      }
    }

    &.steps.steps-vertical {
      @apply block;
    }

    ul {
      @apply my-2;
    }

    li {
      &::marker {
        @apply text-info;
      }
    }
  }

  ol {
    @apply marker:font-bold my-4;

    ol {
      @apply my-2;
    }
  }

  mark {
    @apply bg-error text-error-content p-1 rounded;

    * {
      @apply text-error-content;
    }
  }

  table {
    @apply my-0;

    th, td {
      @apply text-left;
    }
  }

  details {
    @apply my-4;

    .collapse-content {
      @apply bg-base-100 p-4;

      @include shared-styles-nested-margin();
    }

    details {
      summary {
        @apply text-lg after:invisible;
      }
    }
  }

  @include shared-styles-nested-margin();
}
