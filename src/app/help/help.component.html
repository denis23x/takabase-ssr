<!-- @format -->

<ng-container>
	<section class="flex flex-col space-y-4 md:space-y-8">
		<header
			class="rounded-box flex flex-col items-start justify-start gap-4 border border-base-content/20 bg-base-100 p-4 shadow-xl"
		>
			<div class="flex w-full flex-col items-stretch justify-between gap-4">
				<h1 class="block truncate text-2xl font-bold text-base-content">Help & Support</h1>
				<hr class="my-0 border-base-content/20" />
				<p class="alert">
					<i
						class="fill-current text-info"
						appSvgIcon
						[appIcon]="'info-circle'"
						[appSquare]="'1.5em'"
					></i>
					<span class="block">
						Get the assistance you need to navigate our website and make the most of our services.
						Browse through our helpful resources to find answers to your queries. Our goal is to
						provide you with clear and concise guidance on account management, troubleshooting,
						feature explanations, and more.
					</span>
				</p>
			</div>
			<ng-container *appAuthenticated="true">
				<button
					class="btn-success btn-outline btn w-full"
					type="button"
					aria-label="Send feedback"
					(click)="onToggleFeedbackForm(true)"
				>
					Send feedback
				</button>
			</ng-container>
		</header>
		<div class="flex flex-col">
			<nav class="block px-4">
				<ul class="tabs w-full translate-y-px flex-nowrap space-x-1 overflow-auto rounded-t-lg">
					<li
						class="tab tab-lifted tab-lg h-10"
						*ngFor="let help of helpNavigationList"
						[ngClass]="routerLinkActive.isActive ? 'tab-active !h-12' : 'bg-base-200'"
					>
						<a
							class="flex h-full items-center justify-center whitespace-nowrap px-4"
							appScrollPreset
							#routerLinkActive="routerLinkActive"
							[appScrollActive]="routerLinkActive.isActive"
							[routerLink]="['../', help.path]"
							[routerLinkActive]="''"
							[attr.aria-label]="help.name"
						>
							<span class="block truncate max-w-[192px]">{{ help.name }}</span>
						</a>
					</li>
				</ul>
			</nav>
			<div class="rounded-box border border-base-content/20 bg-base-100 p-4 shadow-xl">
				<router-outlet></router-outlet>
			</div>
		</div>
	</section>
	<!-- prettier-ignore-attribute (click) -->
	<dialog
		class="modal"
		#helpFormModal
		(keydown.escape)="$event.preventDefault(); helpFormModal.close()"
		(close)="onToggleFeedbackForm(false)"
		(click)="$event.target === $event.currentTarget ? helpFormModal.close() : $event"
	>
		<div
			appWindow
			[appTitle]="'Feedback'"
			[appButtons]="['close']"
			(closed)="onToggleFeedbackForm(false)"
		>
			<form
				class="flex max-w-lg flex-col gap-4 p-4"
				autocomplete="off"
				slot="content"
				[formGroup]="helpForm"
				(ngSubmit)="onSubmitFeedbackForm()"
			>
				<p class="alert">
					<i
						class="fill-current text-info"
						appSvgIcon
						[appIcon]="'info-circle'"
						[appSquare]="'1.5em'"
					></i>
					<span class="block">
						Your feedback is helping us enhance our services and create a more satisfying experience
						for you
					</span>
				</p>
				<fieldset class="form-control" *ngIf="helpForm.get('name') as name">
					<label class="label" for="feedbackFormName">
						<div class="indicator">
							<!-- prettier-ignore -->
							<span
                class="badge-error badge indicator-item w-max translate-x-full translate-y-0 text-xs"
                *ngIf="name.touched && !!name.errors && helpForm.enabled"
                [ngSwitch]="true"
              >
                <ng-container *ngSwitchCase="!!name.errors.required">
                  Required
                </ng-container>
                <ng-container *ngSwitchCase="!!name.errors.minlength">
                  Min length {{ name.errors.minlength["requiredLength"] }} characters
                </ng-container>
                <ng-container *ngSwitchCase="!!name.errors.maxlength">
                  Max length {{ name.errors.maxlength["requiredLength"] }} characters
                </ng-container>
              </span>
							<span class="label-text mr-2">Name</span>
						</div>
					</label>
					<div class="relative">
						<input
							class="input-bordered input input-md w-full truncate pr-12"
							id="feedbackFormName"
							type="text"
							aria-label="Name"
							formControlName="name"
							placeholder="Type feedback name"
							appInputTrimWhitespace
							[class.input-success]="name.value && name.valid"
							[class.input-error]="name.touched && name.invalid"
						/>
						<button
							class="btn-sm btn-circle btn absolute right-2 top-2 fill-current"
							type="button"
							aria-label="Clear"
							appSvgIcon
							*ngIf="!!name.value.length"
							[class.btn-success]="name.valid"
							[class.btn-error]="name.touched && name.invalid"
							[class.btn-ghost]="name.untouched && name.invalid"
							[disabled]="helpForm.disabled"
							[appIcon]="'x'"
							[appSquare]="'2em'"
							(click)="name.setValue('')"
						></button>
					</div>
				</fieldset>
				<fieldset class="form-control" *ngIf="helpForm.get('description') as description">
					<label class="label" for="feedbackFormDescription">
						<!-- prettier-ignore -->
						<div class="indicator">
              <span
                class="badge-error badge indicator-item w-max translate-x-full translate-y-0 text-xs"
                *ngIf="!!description.value && !!description.errors && helpForm.enabled"
                [ngSwitch]="true"
              >
                <ng-container *ngSwitchCase="!!description.errors.required">
                  Required
                </ng-container>
                <ng-container *ngSwitchCase="!!description.errors.minlength">
                  Min length {{ description.errors.minlength["requiredLength"] }} characters
                </ng-container>
                <ng-container *ngSwitchCase="!!description.errors.maxlength">
                  Max length {{ description.errors.maxlength["requiredLength"] }} characters
                </ng-container>
              </span>
              <span class="label-text mr-2">Description</span>
            </div>
						<!-- prettier-ignore -->
						<span
              class="label-text-alt"
              [class.text-base-content]="helpForm.disabled"
              [class.text-success]="helpForm.enabled && description.value && description.valid"
              [class.text-error]="helpForm.enabled && description.value && description.invalid"
            >
              {{ description.value?.length || 0 }}/255
            </span>
					</label>
					<!-- prettier-ignore -->
					<div
            class="textarea-autosize w-full"
            [ngClass]="{ 'border-base-content/20': helpForm.enabled, 'border-transparent': helpForm.disabled }"
            [class.textarea-autosize-success]="description.value && description.valid"
            [class.textarea-autosize-error]="description.value && description.invalid"
          >
            <textarea
              class="textarea textarea-md w-full max-h-64"
              id="feedbackFormDescription"
              aria-label="Description"
              placeholder="Type feedback description"
              formControlName="description"
              appInputTrimWhitespace
              appTextareaResize
              [appToggleResize]="true"
              [rows]="4"
            >
              {{ description.value }}
            </textarea>
          </div>
				</fieldset>
				<fieldset class="form-control">
					<button
						class="btn-success btn w-full"
						type="submit"
						aria-label="Submit"
						[disabled]="helpForm.invalid || helpForm.disabled"
					>
						<span class="loading loading-spinner" *ngIf="helpForm.disabled"></span>
						Submit
					</button>
				</fieldset>
			</form>
		</div>
	</dialog>
</ng-container>
