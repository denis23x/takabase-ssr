<!-- @format -->

<ng-container>
	<div
		class="flex w-window max-w-[512px] flex-col space-y-4 p-4"
		[class.overflow-hidden]="!cropperIsAvailable"
	>
		<form
			class="flex flex-col space-y-4"
			autocomplete="off"
			[formGroup]="imageForm"
		>
			<fieldset
				class="flex flex-col space-y-4"
				[disabled]="imageFormIsSubmitted || cropperIsSubmitted"
			>
				<p class="alert inline">
					Browse file on your device or paste link from internet
				</p>
				<fieldset class="form-control" *ngIf="imageForm.get('url') as url">
					<label class="label" for="imageFormUrl">
						<div class="indicator">
							<!-- prettier-ignore -->
							<span
								class="badge indicator-item badge-error w-max translate-x-full translate-y-0 text-xs"
								*ngIf="url.touched && !!url.errors && !imageFormIsSubmitted && !cropperIsSubmitted"
								[ngSwitch]="true"
							>
								<ng-container *ngSwitchCase="!!url.errors.required">
									Required
								</ng-container>
								<ng-container *ngSwitchCase="!!url.errors.pattern">
									Url does not correct
								</ng-container>
							</span>
							<span class="label-text mr-2">Image</span>
						</div>
					</label>
					<div class="flex items-center justify-between gap-4">
						<!-- prettier-ignore -->
						<div class="relative w-full">
              <input
                class="input input-bordered w-full truncate pr-12"
                id="imageFormUrl"
                type="text"
                aria-label="Url"
                formControlName="url"
                placeholder="Paste image URL"
                appInputOnlyPaste
                appInputTrimWhitespace
                appInputMarkAsTouched
                [class.input-success]="url.touched && url.value"
                [class.input-error]="url.touched && url.invalid"
                [disabled]="imageFormIsSubmitted || cropperIsSubmitted"
                (input)="onInputUrl()"
              />
              <button
                class="btn btn-circle btn-sm absolute top-2 right-2 fill-current"
                type="button"
                aria-label="Clear query"
                appSvgIcon
                *ngIf="!!url.value.length"
                [class.btn-success]="url.touched && url.value"
                [class.btn-error]="url.touched && url.invalid"
                [class.btn-ghost]="url.untouched"
                [disabled]="imageFormIsSubmitted || cropperIsSubmitted"
                [appIcon]="'x'"
                [appSquare]="'1.75rem'"
                (click)="onResetAll()"
              ></button>
            </div>
						<input
							class="hidden"
							type="file"
							aria-label="File"
							accept="image/jpeg, image/jpg, image/png"
							#imageFormFile
							(change)="onInputFile($event)"
						/>
						<button
							class="btn-primary btn"
							type="button"
							aria-label="Browse"
							[class.loading]="imageFormIsSubmitted"
							[disabled]="imageFormIsSubmitted || cropperIsSubmitted"
							(click)="imageFormFile.click()"
						>
							{{ imageFormIsSubmitted ? "Download" : "Browse" }}
						</button>
					</div>
					<label class="label" for="imageFormUrl">
						<span class="label-text-alt">Accept only *.png, *.jpg files</span>
					</label>
				</fieldset>
			</fieldset>
		</form>
		<div
			class="flex flex-col space-y-4"
			[ngClass]="{ 'invisible !m-0 !h-0': !cropperIsAvailable }"
		>
			<div [class.cursor-not-allowed]="cropperIsSubmitted">
				<!-- prettier-ignore -->
				<image-cropper
          class="ngx-cropper rounded-box !p-4"
          [class.ngx-cropper-disabled]="imageFormIsSubmitted || cropperIsSubmitted"
          [class.ngx-cropper-rounded]="cropperRound"
          [imageFile]="cropperFile"
          [format]="'png'"
          [maintainAspectRatio]="true"
          [containWithinAspectRatio]="false"
          [resizeToWidth]="256"
          [resizeToHeight]="256"
          [cropper]="cropperPosition"
          [roundCropper]="cropperRound"
          [alignImage]="'center'"
          [transform]="imageTransform"
          [allowMoveImage]="cropperBackgroundIsDraggable"
          (imageCropped)="onImageCropped($event)"
          (loadImageFailed)="onImageFailed()"
        >
        </image-cropper>
			</div>
			<div class="flex items-center justify-between gap-4">
				<div [class.cursor-not-allowed]="cropperIsSubmitted">
					<ul
						class="menu rounded-btn menu-horizontal flex-nowrap overflow-x-auto overflow-y-hidden border border-base-content/20"
						[class.pointer-events-none]="cropperIsSubmitted"
						[class.border-transparent]="cropperIsSubmitted"
						[class.bg-base-200]="cropperIsSubmitted"
					>
						<li class="inline-block" [class.disabled]="cropperIsSubmitted">
							<!-- prettier-ignore -->
							<button
                class="fill-current p-3.5 active:bg-base-content/10 active:text-base-content"
                type="button"
                title="Move"
                aria-label="Move"
                appSvgIcon
                [appIcon]="'arrows-move'"
                [ngClass]="{ 'bg-success text-success-content' : cropperBackgroundIsDraggable }"
                (click)="cropperBackgroundIsDraggable = !cropperBackgroundIsDraggable"
              ></button>
						</li>
						<li class="inline-block" [class.disabled]="cropperIsSubmitted">
							<button
								class="-scale-x-1 fill-current p-3.5 active:bg-base-content/10 active:text-base-content"
								type="button"
								title="Rotate counterclockwise"
								aria-label="Rotate counterclockwise"
								appSvgIcon
								[appIcon]="'arrow-clockwise'"
								(click)="onImageRotate(false)"
							></button>
						</li>
						<li class="inline-block" [class.disabled]="cropperIsSubmitted">
							<button
								class="fill-current p-3.5 active:bg-base-content/10 active:text-base-content"
								type="button"
								title="Rotate clockwise"
								aria-label="Rotate clockwise"
								appSvgIcon
								[appIcon]="'arrow-clockwise'"
								(click)="onImageRotate(true)"
							></button>
						</li>
						<li class="inline-block" [class.disabled]="cropperIsSubmitted">
							<button
								class="rotate-90 fill-current p-3.5 active:bg-base-content/10 active:text-base-content"
								type="button"
								title="Flip horizontal"
								aria-label="Flip horizontal"
								appSvgIcon
								[appIcon]="'symmetry-vertical'"
								(click)="onImageFlip(true)"
							></button>
						</li>
						<li class="inline-block" [class.disabled]="cropperIsSubmitted">
							<button
								class="fill-current p-3.5 active:bg-base-content/10 active:text-base-content"
								type="button"
								title="Flip vertical"
								aria-label="Flip vertical"
								appSvgIcon
								[appIcon]="'symmetry-vertical'"
								(click)="onImageFlip(false)"
							></button>
						</li>
						<li class="inline-block" [class.disabled]="cropperIsSubmitted">
							<button
								class="fill-current p-3.5 active:bg-base-content/10 active:text-base-content"
								type="button"
								title="Zoom in"
								aria-label="Zoom in"
								appSvgIcon
								[appIcon]="'zoom-in'"
								(click)="onImageZoom(true)"
							></button>
						</li>
						<li
							class="inline-block"
							[class.disabled]="cropperIsSubmitted || imageTransform.scale <= 1"
						>
							<button
								class="fill-current p-3.5 active:bg-base-content/10 active:text-base-content"
								type="button"
								title="Zoom out"
								aria-label="Zoom out"
								appSvgIcon
								[appIcon]="'zoom-out'"
								(click)="onImageZoom(false)"
							></button>
						</li>
					</ul>
				</div>
				<!-- prettier-ignore -->
				<button
					class="btn btn-error flex-1"
					type="button"
					aria-label="Reset"
          [class.btn-outline]="!imageFormIsSubmitted && !cropperIsSubmitted"
					[disabled]="imageForm.invalid || imageFormIsSubmitted || cropperIsSubmitted"
					(click)="onResetTransform()"
				>
					Reset
				</button>
			</div>
			<!-- prettier-ignore -->
			<button
        class="btn btn-success w-full"
        type="button"
        aria-label="Submit"
        [class.loading]="imageFormIsSubmitted || cropperIsSubmitted"
        [disabled]="imageForm.invalid || imageFormIsSubmitted || cropperIsSubmitted"
        (click)="onSubmitCropper()"
      >
        Submit
      </button>
		</div>
	</div>
</ng-container>
