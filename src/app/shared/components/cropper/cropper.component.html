<!-- @format -->

<ng-container>
	<div class="flex flex-col space-y-4 p-4">
		<form class="block" autocomplete="off" [formGroup]="imageForm">
			<fieldset
				class="flex flex-col space-y-4"
				[disabled]="imageFormIsSubmitted || cropperIsSubmitted"
			>
				<fieldset class="form-control" *ngIf="imageForm.get('url') as url">
					<label class="label" for="imageFormUrl">
						<div class="indicator">
							<span
								class="badge indicator-item badge-error w-max translate-x-full translate-y-0 text-xs"
								*ngIf="url.touched && !!url.errors"
								[ngSwitch]="true"
							>
								<ng-container *ngSwitchCase="!!url.errors.required">
									Required
								</ng-container>
								<ng-container *ngSwitchCase="!!url.errors.customValidator">
									Url does not match pattern
								</ng-container>
							</span>
							<span class="label-text mr-2">File</span>
						</div>
						<span class="label-text-alt">Accept only *.png, *.jpg files</span>
					</label>
					<div class="relative">
						<button
							class="btn no-animation absolute top-0 left-0 rounded-r-none"
							type="button"
							aria-label="Browse"
							[class.btn-success]="url.touched && url.value"
							[class.btn-error]="url.touched && url.invalid"
							[class.btn-disabled]="imageFormIsSubmitted || cropperIsSubmitted"
							(click)="imageFormFile.click()"
						>
							Browse
						</button>
						<!-- prettier-ignore -->
						<input
							class="input input-bordered w-full truncate pl-28 pr-12"
							id="imageFormUrl"
							type="text"
							aria-label="Url"
							formControlName="url"
							placeholder="Paste your URL"
							[class.input-success]="url.touched && url.value"
							[class.input-error]="url.touched && url.invalid"
							[class.input-disabled]="imageFormIsSubmitted || cropperIsSubmitted"
							(keydown)="onInputUrl($event)"
						/>
						<button
							class="btn btn-circle btn-sm absolute top-2 right-2 fill-current"
							type="button"
							title="Clear query"
							aria-label="Clear query"
							appSvgIcon
							*ngIf="!!url.value.length"
							[class.btn-success]="url.touched && url.value"
							[class.btn-error]="url.touched && url.invalid"
							[class.btn-ghost]="url.untouched"
							[class.btn-disabled]="imageFormIsSubmitted || cropperIsSubmitted"
							[appIcon]="'x'"
							[appSquare]="'1.75rem'"
							(click)="onResetImageForm()"
						></button>
						<input
							class="hidden"
							type="file"
							aria-label="File"
							accept="image/jpeg, image/jpg, image/png"
							#imageFormFile
							(change)="onInputFile($event)"
						/>
					</div>
				</fieldset>
				<p class="rounded-box mb-4 bg-base-200 p-4">
					Paste your image link from internet or choose the file on your device
				</p>
			</fieldset>
		</form>
		<div class="flex flex-col space-y-4" [class.hidden]="!cropperFile">
			<image-cropper
				class="ngx-cropper rounded-box !p-4"
				[class.ngx-cropper-disabled]="cropperIsSubmitted"
				[class.ngx-cropper-rounded]="cropperRound"
				[imageFile]="cropperFile"
				[format]="'png'"
				[maintainAspectRatio]="true"
				[containWithinAspectRatio]="false"
				[resizeToWidth]="256"
				[resizeToHeight]="256"
				[cropper]="cropperPosition"
				[roundCropper]="cropperRound"
				[alignImage]="'center'"
				[transform]="imageTransform"
				[allowMoveImage]="cropperBackgroundIsDraggable"
				(imageCropped)="onImageCropped($event)"
			>
			</image-cropper>
			<div class="flex items-center justify-between space-x-4">
				<ul
					class="menu rounded-btn menu-horizontal flex-nowrap overflow-x-auto overflow-y-hidden border border-base-content/20 bg-base-100"
					[class.pointer-events-none]="cropperIsSubmitted"
					[class.border]="!cropperIsSubmitted"
					[class.bg-base-200]="cropperIsSubmitted"
				>
					<li class="inline-block" [class.disabled]="cropperIsSubmitted">
						<!-- prettier-ignore -->
						<button
							class="fill-current"
							type="button"
							title="Move"
							aria-label="Move"
							appSvgIcon
							[appIcon]="'arrows-move'"
							[class.active]="cropperBackgroundIsDraggable"
							(click)="cropperBackgroundIsDraggable = !cropperBackgroundIsDraggable"
						></button>
					</li>
					<li class="inline-block" [class.disabled]="cropperIsSubmitted">
						<button
							class="-scale-x-1 fill-current"
							type="button"
							title="Rotate counterclockwise"
							aria-label="Rotate counterclockwise"
							appSvgIcon
							[appIcon]="'arrow-clockwise'"
							(click)="onImageRotate(false)"
						></button>
					</li>
					<li class="inline-block" [class.disabled]="cropperIsSubmitted">
						<button
							class="fill-current"
							type="button"
							title="Rotate clockwise"
							aria-label="Rotate clockwise"
							appSvgIcon
							[appIcon]="'arrow-clockwise'"
							(click)="onImageRotate(true)"
						></button>
					</li>
					<li class="inline-block" [class.disabled]="cropperIsSubmitted">
						<button
							class="fill-current"
							type="button"
							title="Flip horizontal"
							aria-label="Flip horizontal"
							appSvgIcon
							[appIcon]="'symmetry-horizontal'"
							(click)="onImageFlip(true)"
						></button>
					</li>
					<li class="inline-block" [class.disabled]="cropperIsSubmitted">
						<button
							class="fill-current"
							type="button"
							title="Flip vertical"
							aria-label="Flip vertical"
							appSvgIcon
							[appIcon]="'symmetry-vertical'"
							(click)="onImageFlip(false)"
						></button>
					</li>
					<li class="inline-block" [class.disabled]="cropperIsSubmitted">
						<button
							class="fill-current"
							type="button"
							title="Zoom in"
							aria-label="Zoom in"
							appSvgIcon
							[appIcon]="'zoom-in'"
							(click)="onImageZoom(true)"
						></button>
					</li>
					<li
						class="inline-block"
						[class.disabled]="cropperIsSubmitted || imageTransform.scale <= 1"
					>
						<button
							class="fill-current"
							type="button"
							title="Zoom out"
							aria-label="Zoom out"
							appSvgIcon
							[appIcon]="'zoom-out'"
							(click)="onImageZoom(false)"
						></button>
					</li>
				</ul>
				<!-- prettier-ignore -->
				<button
					class="btn btn-error"
					type="button"
					aria-label="Reset"
					[disabled]="imageForm.invalid || imageFormIsSubmitted || cropperIsSubmitted"
					(click)="onImageReset()"
				>
					Reset
				</button>
			</div>
		</div>
		<!-- prettier-ignore -->
		<button
			class="btn btn-primary w-full"
			type="button"
			aria-label="Submit"
			[class.loading]="imageFormIsSubmitted || cropperIsSubmitted"
			[disabled]="imageForm.invalid || imageFormIsSubmitted || cropperIsSubmitted"
			(click)="onSubmitCropper()"
		>
			Submit
		</button>
	</div>
</ng-container>
