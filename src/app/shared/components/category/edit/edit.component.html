<!-- @format -->

<app-overlay (clicked)="closed.emit(false)">
	<section
		class="pointer-events-none absolute inset-0 flex items-center justify-center p-4"
		slot="content"
	>
		<form
			class="bg-primary-3 pointer-events-auto flex max-h-full w-11/12 max-w-full flex-col space-y-4 rounded-lg p-4 shadow-lg sm:w-96"
			autocomplete="off"
			[formGroup]="categoryForm"
			(ngSubmit)="onSubmitCategoryForm()"
		>
			<div
				class="border-primary-4 flex items-center justify-between border-b pb-2"
			>
				<span class="text-secondary-1 block text-xl font-medium leading-9">{{
					categoryFormIsToggled ? "Delete category" : "Edit category"
				}}</span>
				<button
					class="text-secondary-1 hover:text-danger-1 fill-current p-2 opacity-25 hover:opacity-100"
					type="button"
					aria-label="Close"
					appSvgIcon
					[appIcon]="'x-lg'"
					[appSquare]="'1rem'"
					(click)="closed.emit(false)"
				></button>
			</div>
			<fieldset
				class="flex flex-col space-y-4"
				[disabled]="categoryFormIsSubmitted"
			>
				<fieldset
					class="flex flex-col space-y-2"
					*ngIf="categoryForm.get('name') as name"
				>
					<div class="flex items-center justify-between text-sm">
						<label class="text-secondary-2 block text-sm" for="name"
							>Name</label
						>
						<ng-container [ngSwitch]="categoryFormIsToggled">
							<button
								class="text-danger-1 hover:underline"
								type="button"
								aria-label="Delete"
								*ngSwitchDefault
								(click)="onToggle(true)"
							>
								Delete
							</button>
							<button
								class="text-info-1 hover:underline"
								type="button"
								aria-label="Edit"
								*ngSwitchCase="true"
								(click)="onToggle(false)"
							>
								Edit
							</button>
						</ng-container>
					</div>
					<input
						class="bg-primary-2 form-control truncate"
						id="name"
						type="text"
						aria-label="Name"
						formControlName="name"
						placeholder="Name"
						appInputTrimWhitespace
					/>
					<label
						class="text-danger-1 mt-2 block text-sm"
						for="name"
						*ngIf="name.touched && !!name.errors"
						[ngSwitch]="true"
					>
						<ng-container *ngSwitchCase="!!name.errors.required"
							>Required</ng-container
						>
						<ng-container *ngSwitchCase="!!name.errors.minlength"
							>Min length
							{{ name.errors.minlength["requiredLength"] }}
							characters</ng-container
						>
						<ng-container *ngSwitchCase="!!name.errors.maxlength"
							>Max length
							{{ name.errors.maxlength["requiredLength"] }}
							characters</ng-container
						>
					</label>
					<ng-container [ngSwitch]="categoryFormIsToggled">
						<ng-container *ngSwitchDefault>
							<p class="text-secondary-2 text-sm">
								Category
								<span class="text-secondary-1 font-bold">{{
									category.name
								}}</span>
								was created {{ category.createdAt | dayjs: "fromX" }}
							</p>
						</ng-container>
						<ng-container *ngSwitchCase="true">
							<span class="text-secondary-2 mt-2 block text-sm"
								>Please type
								<span class="text-secondary-1 font-bold">{{
									category.name
								}}</span>
								to confirm</span
							>
							<p
								class="text-danger-1 border-danger-1 rounded-md border py-2.5 px-3 text-sm"
							>
								This action cannot be undone, it will permanently delete
								category and delete all posts in it
							</p>
						</ng-container>
					</ng-container>
				</fieldset>
				<button
					class="md btn w-full"
					type="submit"
					aria-label="Submit"
					[ngClass]="{
						'btn-success': !categoryFormIsToggled,
						'btn-danger': categoryFormIsToggled
					}"
					[disabled]="categoryForm.invalid || categoryFormIsSubmitted"
				>
					Submit
				</button>
			</fieldset>
		</form>
	</section>
</app-overlay>
