<!-- @format -->

<ng-container>
	<!-- prettier-ignore-attribute (click) -->
	<dialog
		class="modal"
		#cropperDialogElement
		(keydown.escape)="$event.preventDefault(); cropperDialogElement.close()"
		(close)="onToggleCropper(false)"
		(click)="$event.target === $event.currentTarget ? cropperDialogElement.close() : $event"
	>
		<div
			class="flex items-center justify-center w-full max-w-lg"
			appWindow
			[appWindowTitle]="'Cropper'"
			[appWindowButtons]="['close']"
			(appWindowClose)="onToggleCropper(false)"
		>
			<div
				class="flex flex-col p-4"
				slot="content"
				[class.overflow-hidden]="!cropperIsAvailable"
				[class.gap-4]="cropperIsAvailable"
			>
				<!-- prettier-ignore -->
				<form
					class="flex flex-col gap-4"
					autocomplete="off"
					[formGroup]="imageForm"
					[ngClass]="{ 'hidden': cropperIsAvailable }"
				>
					<p class="alert" role="alert">
						<i
							class="fill-current text-info"
							appSvgIcon
							[appSvgIconIcon]="'info-circle'"
							[appSvgIconSquare]="'1.5em'"
						></i>
						<span class="block"> Browse file on your device or paste link from internet </span>
					</p>
					<fieldset class="form-control" *ngIf="imageForm.get('url') as url">
						<label class="label" for="imageFormUrl">
							<div class="indicator">
								<span
									class="badge indicator-item badge-error w-max translate-x-full translate-y-0 text-xs"
									*ngIf="url.dirty && !!url.errors && imageForm.enabled"
									[ngSwitch]="true"
								>
									<ng-container *ngSwitchCase="!!url.errors.required"> Required </ng-container>
									<ng-container *ngSwitchCase="!!url.errors.pattern">
										Url does not correct
									</ng-container>
								</span>
								<span class="label-text mr-2">Image</span>
							</div>
						</label>
						<div class="flex items-center justify-between gap-4">
							<div class="relative w-full">
								<input
									class="input input-bordered input-md w-full !pr-12"
									id="imageFormUrl"
									type="text"
									aria-label="Url"
									formControlName="url"
									placeholder="Paste image from clipboard or URL"
									appInputOnlyPaste
									appInputTrimWhitespace
									[class.input-success]="url.value && url.valid"
									[class.input-error]="url.dirty && url.invalid"
                  (input)="onGetFileFromInternet($event)"
                  (paste)="onGetFileFromDeviceClipboard($event)"
								/>
								<button
									class="btn btn-circle btn-sm absolute top-2 right-2 fill-current"
									type="button"
									aria-label="Clear"
									appSvgIcon
									*ngIf="!!url.value.length"
									[class.btn-success]="url.valid"
									[class.btn-error]="url.dirty && url.invalid"
									[class.btn-ghost]="url.pristine && url.invalid"
									[disabled]="imageForm.disabled"
									[appSvgIconIcon]="'x'"
									[appSvgIconSquare]="'2em'"
									(click)="url.setValue('')"
								></button>
							</div>
							<input
								class="hidden"
								type="file"
								#imageFormFile
								[accept]="imageFormMime"
								(change)="onGetFileFromDevice($event)"
							/>
							<button
								class="btn-success btn-square btn fill-current p-3"
								type="button"
								aria-label="Browse"
								[class.btn-outline]="imageForm.enabled"
								[disabled]="imageForm.disabled"
								[ngSwitch]="imageForm.disabled && !cropperFile"
								(click)="imageFormFile.click()"
							>
								<span class="loading loading-spinner" *ngSwitchCase="true"></span>
								<i
									class="block"
									appSvgIcon
									*ngSwitchDefault
									[appSvgIconIcon]="'folder'"
									[appSvgIconSquare]="'1.75em'"
								>
								</i>
							</button>
						</div>
						<label class="label" for="imageFormUrl">
							<span class="label-text-alt">Accept only *.png, *.jpg files</span>
						</label>
					</fieldset>
				</form>
				<div class="flex flex-col gap-4" [ngClass]="{ 'invisible !m-0 !h-0': !cropperIsAvailable }">
					<div
            class="block -m-4"
            [ngClass]="{ 'cursor-not-allowed saturate-0': imageForm.disabled }"
          >
						<image-cropper
							class="ngx-cropper aspect-square !p-4"
							*appPlatform="'browser'"
							[class.ngx-cropper-disabled]="imageForm.disabled"
							[class.ngx-cropper-move-image]="cropperBackgroundIsDraggable"
							[imageFile]="cropperFile"
							[imageAltText]="'Image cropper'"
							[format]="'png'"
							[maintainAspectRatio]="true"
							[containWithinAspectRatio]="true"
              [resizeToWidth]="512"
              [resizeToHeight]="512"
							[cropper]="cropperPosition"
							[roundCropper]="false"
							[alignImage]="'center'"
							[(transform)]="imageTransform"
							[allowMoveImage]="cropperBackgroundIsDraggable"
							(imageCropped)="onImageCropped($event)"
							(loadImageFailed)="onImageFailed()"
						>
						</image-cropper>
					</div>
					<div class="flex items-start justify-between gap-4">
						<!-- prettier-ignore -->
						<div
							class="flex overflow-auto rounded-btn border border-base-content/20"
							[ngClass]="{ 'border-transparent bg-base-200 cursor-not-allowed': imageForm.disabled }"
						>
							<ul class="menu rounded-btn menu-horizontal menu-md flex-nowrap border-none p-0">
                <li
                  class="inline-block"
                  [ngClass]="{ 'disabled pointer-events-none': imageForm.disabled }"
                >
                  <button
                    class="fill-current p-3"
                    type="button"
                    title="Move"
                    aria-label="Move"
                    appSvgIcon
                    [class.cursor-not-allowed]="imageForm.disabled"
                    [disabled]="imageForm.disabled"
                    [appSvgIconIcon]="'arrows-move'"
                    [appSvgIconSquare]="'1.5725em'"
                    [ngClass]="{ 'active' : cropperBackgroundIsDraggable && imageForm.enabled, 'bg-base-content/10' : cropperBackgroundIsDraggable && imageForm.disabled }"
                    (click)="cropperBackgroundIsDraggable = !cropperBackgroundIsDraggable"
                  ></button>
                </li>
                <li
                  class="inline-block"
                  [ngClass]="{ 'disabled pointer-events-none': imageForm.disabled }"
                >
                  <button
                    class="-scale-x-1 fill-current p-3"
                    type="button"
                    title="Rotate counterclockwise"
                    aria-label="Rotate counterclockwise"
                    appSvgIcon
                    [class.cursor-not-allowed]="imageForm.disabled"
                    [disabled]="imageForm.disabled"
                    [appSvgIconIcon]="'arrow-clockwise'"
                    [appSvgIconSquare]="'1.5725em'"
                    (click)="onImageRotate(false)"
                  ></button>
                </li>
                <li
                  class="inline-block"
                  [ngClass]="{ 'disabled pointer-events-none': imageForm.disabled }"
                >
                  <button
                    class="fill-current p-3"
                    type="button"
                    title="Rotate clockwise"
                    aria-label="Rotate clockwise"
                    appSvgIcon
                    [class.cursor-not-allowed]="imageForm.disabled"
                    [disabled]="imageForm.disabled"
                    [appSvgIconIcon]="'arrow-clockwise'"
                    [appSvgIconSquare]="'1.5725em'"
                    (click)="onImageRotate(true)"
                  ></button>
                </li>
                <li
                  class="inline-block"
                  [ngClass]="{ 'disabled pointer-events-none': imageForm.disabled }"
                >
                  <button
                    class="rotate-90 fill-current p-3"
                    type="button"
                    title="Flip horizontal"
                    aria-label="Flip horizontal"
                    appSvgIcon
                    [class.cursor-not-allowed]="imageForm.disabled"
                    [disabled]="imageForm.disabled"
                    [appSvgIconIcon]="'symmetry-vertical'"
                    [appSvgIconSquare]="'1.5725em'"
                    (click)="onImageFlip(true)"
                  ></button>
                </li>
                <li
                  class="inline-block"
                  [ngClass]="{ 'disabled pointer-events-none': imageForm.disabled }"
                >
                  <button
                    class="fill-current p-3"
                    type="button"
                    title="Flip vertical"
                    aria-label="Flip vertical"
                    appSvgIcon
                    [class.cursor-not-allowed]="imageForm.disabled"
                    [disabled]="imageForm.disabled"
                    [appSvgIconIcon]="'symmetry-vertical'"
                    [appSvgIconSquare]="'1.5725em'"
                    (click)="onImageFlip(false)"
                  ></button>
                </li>
                <li
                  class="inline-block"
                  [ngClass]="{ 'disabled pointer-events-none': imageForm.disabled }"
                >
                  <button
                    class="fill-current p-3"
                    type="button"
                    title="Zoom in"
                    aria-label="Zoom in"
                    appSvgIcon
                    [class.cursor-not-allowed]="imageForm.disabled"
                    [disabled]="imageForm.disabled"
                    [appSvgIconIcon]="'zoom-in'"
                    [appSvgIconSquare]="'1.5725em'"
                    (click)="onImageZoom(true)"
                  ></button>
                </li>
                <li
                  class="inline-block"
                  [ngClass]="{ 'disabled pointer-events-none': imageForm.disabled || imageTransform.scale <= 1 }"
                >
                  <button
                    class="fill-current p-3"
                    type="button"
                    title="Zoom out"
                    aria-label="Zoom out"
                    appSvgIcon
                    [class.cursor-not-allowed]="imageForm.disabled"
                    [disabled]="imageForm.disabled"
                    [appSvgIconIcon]="'zoom-out'"
                    [appSvgIconSquare]="'1.5725em'"
                    (click)="onImageZoom(false)"
                  ></button>
                </li>
                <li
                  class="inline-block"
                  [ngClass]="{ 'disabled pointer-events-none': imageForm.disabled }"
                >
                  <div
                    class="flex p-0"
                    appDropdown
                    #dropdownAspectRatio
                    *ngIf="{ value: false } as toggle"
                    [ngClass]="{ 'bg-base-content/10': toggle.value }"
                    [appDropdownPosition]="'top-left'"
                    (appDropdownToggle)="toggle.value = $event"
                  >
                    <button
                      class="fill-current p-3"
                      type="button"
                      title="Aspect Ratio"
                      aria-label="Aspect Ratio"
                      appSvgIcon
                      slot="target"
                      [class.cursor-not-allowed]="imageForm.disabled"
                      [disabled]="imageForm.disabled"
                      [appSvgIconIcon]="'aspect-ratio'"
                      [appSvgIconSquare]="'1.5725em'"
                    ></button>
                    <ul class="menu menu-vertical menu-md" slot="content">
                      <li class="flex w-full" *ngFor="let aspectRatio of ['1:1', '4:3', '16:9', '16:10']">
                        <button
                          class="w-full whitespace-nowrap text-base-content"
                          type="button"
                          [attr.aria-label]="aspectRatio"
                          (click)="onImageAspectRatio()"
                        >
                          <span class="block">
                            {{ aspectRatio }}
                          </span>
                        </button>
                      </li>
                    </ul>
                  </div>
                </li>
                <li
                  class="inline-block"
                  [ngClass]="{ 'disabled pointer-events-none': imageForm.disabled }"
                >
                  <button
                    class="fill-current p-3"
                    type="button"
                    title="Sliders"
                    aria-label="Sliders"
                    appSvgIcon
                    [class.cursor-not-allowed]="imageForm.disabled"
                    [disabled]="imageForm.disabled"
                    [appSvgIconIcon]="'sliders'"
                    [appSvgIconSquare]="'1.5725em'"
                    (click)="onImageSliders()"
                  ></button>
                </li>
              </ul>
						</div>
						<div class="flex p-0 relative" appDropdown [appDropdownPosition]="'top-right'">
							<button
								class="btn-ghost w-12 h-12 btn-square btn bg-base-200 fill-current"
								type="button"
								title="Menu"
								aria-label="Menu"
								appSvgIcon
								slot="target"
								[disabled]="imageForm.disabled"
								[appSvgIconIcon]="'three-dots-vertical'"
								[appSvgIconSquare]="'1.5em'"
							></button>
							<ul class="menu menu-vertical menu-md" slot="content">
								<li class="flex w-full snap-start scroll-my-2">
									<button
										class="rounded-btn block w-full truncate text-right"
										type="button"
										title="Reset cropper"
										aria-label="Reset cropper"
										(click)="onResetCropper()"
									>
										Reset cropper
									</button>
								</li>
								<li class="flex w-full snap-start scroll-my-2">
									<button
										class="rounded-btn block w-full truncate text-right"
										type="button"
										title="Reset changes"
										aria-label="Reset changes"
										(click)="onResetTransform()"
									>
										Reset changes
									</button>
								</li>
							</ul>
						</div>
					</div>
					<form class="flex flex-col bg-base-200 rounded-box p-4" *ngIf="imageFormSlidersToggle">
						<fieldset class="form-control">
							<label class="label">
								<span class="label-text">Brightness</span>
							</label>
							<div class="relative flex items-center justify-between w-full gap-4">
								<input class="range w-full" type="range" value="20" min="0" max="100" />
								<span class="block badge badge-ghost" aria-label="Brightness"> 75 </span>
							</div>
						</fieldset>
						<fieldset class="form-control">
							<label class="label">
								<span class="label-text">Saturation</span>
							</label>
							<div class="relative flex items-center justify-between w-full gap-4">
								<input class="range w-full" type="range" value="20" min="0" max="100" />
								<span class="block badge badge-ghost" aria-label="Saturation"> 75 </span>
							</div>
						</fieldset>
						<fieldset class="form-control">
							<label class="label">
								<span class="label-text">HUE</span>
							</label>
							<div class="relative flex items-center justify-between w-full gap-4">
								<input class="range w-full" type="range" value="40" min="0" max="360" />
								<span class="block badge badge-ghost" aria-label="HUE"> 255 </span>
							</div>
						</fieldset>
					</form>
					<button
						class="btn btn-success w-full"
						type="button"
						aria-label="Submit"
						[disabled]="imageForm.disabled"
						(click)="onSubmitCropper()"
					>
						<span class="loading loading-spinner" *ngIf="imageForm.disabled"></span>
						Submit
					</button>
				</div>
			</div>
		</div>
	</dialog>
</ng-container>
