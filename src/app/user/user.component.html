<section class="page-user grid md:gap-x-4 px-4">
  <aside class="aside">
    <div class="sticky top-0 py-4">
      <div class="flex flex-col space-y-4 bg-primary-3 border border-primary-4 rounded-md p-4" >
        <div class="flex items-center md:items-start space-x-4 md:space-x-0 md:space-y-4 md:flex-col">
          <div class="flex border border-primary-4 overflow-hidden rounded-md h-16 w-16 md:h-44 md:w-44" [appUser]="user" appAvatar></div>
          <div class="flex flex-col flex-1">
            <div class="grid">
              <span class="block text-secondary-1 truncate">{{user.name}}</span>
            </div>
            <time
              class="text-secondary-2 text-sm"
              [attr.datetime]="user.createdAt | dayjs : 'format' : 'YYYY-M-D'">registered {{user.createdAt | dayjs : 'fromX'}}
            </time>
          </div>
        </div>
        <p
          class="border-t border-primary-4 pt-4"
          [ngClass]="user.biography ? 'text-secondary-1' : 'text-secondary-2'"
          [innerHTML]="user.biography || 'User does not have biography'"></p>
      </div>
    </div>
  </aside>
  <div class="view grid grid-cols-1 grid-rows-1 self-start">
    <header class="header bg-primary-2 border-b border-t md:border-t-0 border-primary-4 z-20 sticky -top-px py-2">
      <nav class="flex justify-between items-center border border-primary-4 bg-primary-3 rounded-md">
        <ng-container *ngIf="categoryList.length; else categoryListEmptyTemplate;">
          <ul class="flex justify-start items-center overflow-auto px-1" #scrollRoot>
            <li class="inline-block">
              <a
                class="block text-secondary-1 hover:text-info-1 hover:underline p-2"
                [routerLink]="['.']"
                [routerLinkActive]="'text-info-1'"
                [routerLinkActiveOptions]="{ exact: true }"
                aria-label="All">All
              </a>
            </li>
            <li class="inline-block" *ngFor="let category of categoryList">
              <a
                class="block text-secondary-1 hover:text-info-1 hover:underline whitespace-nowrap p-2"
                appScrollIntoView
                [appRoot]="scrollRoot"
                [appActive]="rla.isActive"
                [routerLink]="['./category', category.id]"
                [routerLinkActive]="'text-info-1'"
                [attr.aria-label]="category.name"
                #rla="routerLinkActive">{{category.name}}
              </a>
            </li>
          </ul>
          <app-dropdown
            class="flex relative"
            *ngIf="{ value: false } as active"
            (toggled)="active.value = $event">
            <button
              class="block fill-current text-secondary-1 hover:text-info-1 p-2"
              [class.text-info-1]="active.value"
              type="button"
              aria-label="Menu"
              appSvgIcon
              [appIcon]="'list'"
              [appSquare]="'1.5rem'"
              slot="toggle">
            </button>
            <div class="absolute z-30 top-full right-0 flex flex-col items-end -mt-2" slot="content">
              <div class="w-3 overflow-hidden inline-block mx-3.5">
                <div class="h-2 w-2 bg-primary-2 rotate-45 origin-bottom-left"></div>
              </div>
              <ul class="flex flex-col bg-primary-2 rounded-md shadow-lg py-2" [ngSwitch]="userMe">
                <ng-container *ngSwitchCase="true">
                  <li class="block">
                    <button
                      class="text-secondary-1 text-left hover:text-info-1 hover:bg-primary-1 hover:underline whitespace-nowrap w-full py-2 px-4"
                      type="button"
                      aria-label="Create"
                      (click)="categoryModal = 'create'">Create
                    </button>
                  </li>
                  <ng-container *ngIf="category">
                    <li class="block">
                      <button
                        class="text-secondary-1 text-left hover:bg-primary-1 group whitespace-nowrap w-full py-2 px-4"
                        type="button"
                        [attr.aria-label]="'Edit: ' + category.name"
                        (click)="categoryModal = 'edit'">Edit:
                        <span class="text-info-1 group-hover:underline">{{category.name}}</span>
                      </button>
                    </li>
                  </ng-container>
                </ng-container>
                <ng-container *ngSwitchCase="false">
                  <li class="block">
                    <a
                      class="block text-secondary-1 hover:text-info-1 hover:underline hover:bg-primary-1 whitespace-nowrap w-full py-2 px-4"
                      [routerLink]="['.']"
                      aria-label="Bad content">Bad content
                    </a>
                  </li>
                </ng-container>
              </ul>
            </div>
          </app-dropdown>
        </ng-container>
      </nav>
      <div class="flex items-center justify-between text-secondary-2 text-sm pt-2">
        <div class="block">Latest</div>
        <div class="flex items-center justify-end text-info-1" (click)="categoryModal = 'create'">Edit</div>
      </div>
    </header>
    <div class="content">
      <router-outlet></router-outlet>
    </div>
  </div>
  <ng-template #categoryListEmptyTemplate>
    <div class="text-secondary-1 px-3 py-2">No categories were found
      <button
        class="text-info-1 hover:underline"
        type="button"
        aria-label="Create category"
        (click)="categoryModal = 'create'">you need to create at least one
      </button>
    </div>
  </ng-template>
  <ng-container [ngSwitch]="categoryModal">
    <app-category-create
      *ngSwitchCase="'create'"
      (submitted)="onSubmitCategoryForm($event)"
      (closed)="categoryModal = undefined">
    </app-category-create>
    <app-category-edit
      *ngSwitchCase="'edit'"
      [appCategory]="category"
      (submitted)="onSubmitCategoryForm($event)"
      (closed)="categoryModal = undefined">
    </app-category-edit>
  </ng-container>
</section>
