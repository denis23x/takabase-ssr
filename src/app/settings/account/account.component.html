<!-- @format -->

<ng-container>
	<div class="flex flex-col items-start justify-start gap-4">
		<form
			class="rounded-box flex w-full flex-col"
			autocomplete="off"
			[formGroup]="emailForm"
			(ngSubmit)="onSubmitEmailForm()"
		>
			<fieldset
				class="flex flex-col space-y-4"
				[disabled]="emailFormIsSubmitted"
			>
				<fieldset class="form-control" *ngIf="emailForm.get('email') as email">
					<label class="label" for="emailFormEmail">
						<div class="indicator">
							<span
								class="badge indicator-item badge-error w-max translate-x-full translate-y-0 text-xs"
								*ngIf="email.touched && !!email.errors"
								[ngSwitch]="true"
							>
								<ng-container *ngSwitchCase="!!email.errors.required">
									Required
								</ng-container>
								<ng-container *ngSwitchCase="!!email.errors.email">
									Email must be a real email address
								</ng-container>
							</span>
							<span class="label-text mr-2">New Email</span>
						</div>
						<span class="label-text-alt">
							<a
								class="link"
								target="_blank"
								rel="noopener"
								[href]="'mailto:' + authUser.email"
							>
								{{ authUser.email }}
							</a>
						</span>
					</label>
					<div class="relative">
						<input
							class="input input-bordered w-full truncate pr-12"
							id="emailFormEmail"
							type="email"
							aria-label="Email"
							formControlName="email"
							placeholder="Type your new Email"
							[class.input-success]="email.touched && email.valid"
							[class.input-error]="email.touched && email.invalid"
							[class.input-disabled]="emailFormIsSubmitted"
						/>
						<button
							class="btn btn-circle btn-sm absolute top-2 right-2 fill-current"
							type="button"
							title="Clear"
							aria-label="Clear"
							appSvgIcon
							*ngIf="!!email.value.length"
							[class.btn-success]="email.touched && email.valid"
							[class.btn-error]="email.touched && email.invalid"
							[class.btn-ghost]="email.untouched"
							[class.btn-disabled]="emailFormIsSubmitted"
							[appIcon]="'x'"
							[appSquare]="'1.75rem'"
							(click)="email.setValue('')"
						></button>
					</div>
				</fieldset>
				<fieldset class="form-control">
					<button
						class="btn btn-primary w-full"
						type="submit"
						aria-label="Submit"
						[disabled]="emailForm.invalid || emailFormIsSubmitted"
					>
						Submit
					</button>
				</fieldset>
			</fieldset>
		</form>
		<form
			class="rounded-box flex w-full flex-col"
			autocomplete="off"
			[formGroup]="passwordForm"
			(ngSubmit)="onSubmitPasswordForm()"
		>
			<fieldset
				class="flex flex-col space-y-4"
				[disabled]="passwordFormIsSubmitted"
			>
				<fieldset
					class="form-control"
					*ngIf="passwordForm.get('password') as password"
				>
					<label class="label" for="passwordFormPassword">
						<div class="indicator">
							<span
								class="badge indicator-item badge-error w-max translate-x-full translate-y-0 text-xs"
								*ngIf="password.touched && !!password.errors"
								[ngSwitch]="true"
							>
								<ng-container *ngSwitchCase="!!password.errors.required">
									Required
								</ng-container>
								<ng-container *ngSwitchCase="!!password.errors.pattern">
									Password does not match pattern
								</ng-container>
							</span>
							<span class="label-text mr-2">New password</span>
						</div>
					</label>
					<div class="relative" *ngIf="{ value: false } as isVisible">
						<input
							class="input input-bordered w-full truncate pr-12"
							id="passwordFormPassword"
							aria-label="Password"
							formControlName="password"
							autocomplete="new-password"
							placeholder="Type your new password"
							[type]="isVisible.value ? 'text' : 'password'"
							[class.input-success]="password.touched && password.valid"
							[class.input-error]="password.touched && password.invalid"
							[class.input-disabled]="passwordFormIsSubmitted"
						/>
						<button
							class="btn btn-circle btn-sm absolute top-2 right-2 fill-current"
							type="button"
							title="Password"
							aria-label="Password"
							appSvgIcon
							*ngIf="!!password.value.length"
							[class.btn-success]="password.touched && password.value"
							[class.btn-error]="password.touched && password.invalid"
							[class.btn-ghost]="password.untouched"
							[class.btn-disabled]="passwordFormIsSubmitted"
							[appIcon]="'incognito'"
							[appSquare]="'1.5em'"
							(touchstart)="isVisible.value = !isVisible.value"
							(mouseenter)="isVisible.value = true"
							(mouseleave)="isVisible.value = false"
						></button>
					</div>
				</fieldset>
				<p class="rounded-box mt-2 mb-4 bg-base-200 p-4">
					The password must be 6-32 characters long, must contain at least one
					number or special character
				</p>
				<fieldset class="form-control">
					<button
						class="btn btn-primary w-full"
						type="submit"
						aria-label="Submit"
						[disabled]="passwordForm.invalid || passwordFormIsSubmitted"
					>
						Submit
					</button>
				</fieldset>
			</fieldset>
		</form>
	</div>
	<app-overlay
		[appToggle]="confirmationFormToggle"
		(clicked)="onToggleConfirmationForm(false)"
		(escaped)="onToggleConfirmationForm(false)"
	>
		<app-window
			slot="content"
			[appTitle]="'Confirmation'"
			(closed)="onToggleConfirmationForm(false)"
		>
			<form
				class="flex w-full w-window max-w-[448px] flex-col bg-base-100 p-4"
				autocomplete="off"
				slot="content"
				[formGroup]="confirmationForm"
				(ngSubmit)="onSubmitConfirmationForm()"
			>
				<p class="rounded-box mb-4 bg-base-200 p-4">
					Confirmation will terminate all sessions
				</p>
				<fieldset
					class="flex flex-col space-y-4"
					[disabled]="confirmationFormIsSubmitted"
				>
					<fieldset
						class="form-control"
						*ngIf="confirmationForm.get('password') as password"
					>
						<label class="label" for="confirmationFormPassword">
							<div class="indicator">
								<span
									class="badge indicator-item badge-error w-max translate-x-full translate-y-0 text-xs"
									*ngIf="password.touched && !!password.errors"
									[ngSwitch]="true"
								>
									<ng-container *ngSwitchCase="!!password.errors.required">
										Required
									</ng-container>
									<ng-container *ngSwitchCase="!!password.errors.pattern">
										Password does not match pattern
									</ng-container>
								</span>
								<span class="label-text mr-2">Current password</span>
							</div>
						</label>
						<div class="relative" *ngIf="{ value: false } as isVisible">
							<input
								class="input input-bordered w-full truncate pr-12"
								id="confirmationFormPassword"
								aria-label="Password"
								formControlName="password"
								autocomplete="new-password"
								placeholder="Type your current password"
								[type]="isVisible.value ? 'text' : 'password'"
								[class.input-success]="password.touched && password.valid"
								[class.input-error]="password.touched && password.invalid"
								[class.input-disabled]="confirmationFormIsSubmitted"
							/>
							<button
								class="btn btn-circle btn-sm absolute top-2 right-2 fill-current"
								type="button"
								title="Password"
								aria-label="Password"
								appSvgIcon
								*ngIf="!!password.value.length"
								[class.btn-success]="password.touched && password.value"
								[class.btn-error]="password.touched && password.invalid"
								[class.btn-ghost]="password.untouched"
								[class.btn-disabled]="confirmationFormIsSubmitted"
								[appIcon]="'incognito'"
								[appSquare]="'1.5em'"
								(touchstart)="isVisible.value = !isVisible.value"
								(mouseenter)="isVisible.value = true"
								(mouseleave)="isVisible.value = false"
							></button>
						</div>
					</fieldset>
					<fieldset class="form-control">
						<!-- prettier-ignore -->
						<button
							class="btn btn-primary w-full"
							type="submit"
							aria-label="Confirm"
							[class.loading]="confirmationFormIsSubmitted"
							[disabled]="confirmationForm.invalid || confirmationFormIsSubmitted"
						>
              Confirm
						</button>
					</fieldset>
				</fieldset>
			</form>
		</app-window>
	</app-overlay>
</ng-container>
